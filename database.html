<!DOCTYPE html>
<td><span class="pill">${r.location}</span></td>
<td>${r.snack}</td>
<td>${r.shirt}</td>
<td>${r.crumbs? 'Yes' : 'No'}</td>
</tr>
`).join('');
}

function buildQuery(){
if(active.size === 0) return 'SELECT * FROM suspects;';
const parts = [];
for (const id of active){
if(id==='c1') parts.push("location = 'Classroom'");
if(id==='c2') parts.push("uniform = 'Blue'");
if(id==='c3') parts.push("item = 'Hat'");
if(id==='c4') parts.push("chalk = TRUE");
if(id==='c5') parts.push("location <> 'Playground'");
if(id==='c2') parts.push("shirt = 'Blue'");
if(id==='c3') parts.push("snack = 'Muffin'");
if(id==='c4') parts.push("crumbs = TRUE");
if(id==='c5') parts.push("location <> 'Playground'");
}
return `SELECT * FROM suspects\nWHERE ${parts.join(' AND ')};`;
}

function applyFilters(){
let filtered = suspects.slice();
for (const id of active){
const rule = clues.find(c=>c.id===id).filter;
filtered = filtered.filter(rule);
}
renderTable(filtered);
queryBox.textContent = buildQuery();
if(filtered.length === 1){
win.style.display = 'inline-flex';
} else {
win.style.display = 'none';
}
}

function renderClues(){
clueList.innerHTML = clues.map(c=>`
<label class="clue" for="${c.id}" id="label-${c.id}">
<input type="checkbox" id="${c.id}" />
<span>${c.label}</span>
</label>
`).join('');
clues.forEach(c=>{
const cb = document.getElementById(c.id);
const lab = document.getElementById('label-'+c.id);
cb.addEventListener('change',()=>{
if(cb.checked){ active.add(c.id); lab.classList.add('active'); }
else { active.delete(c.id); lab.classList.remove('active'); }
applyFilters();
});
});
}

// Buttons
document.getElementById('resetBtn').addEventListener('click',()=>{
active.clear();
document.querySelectorAll('.clue input').forEach(cb=>{cb.checked=false});
document.querySelectorAll('.clue').forEach(l=>l.classList.remove('active'));
applyFilters();
});

document.getElementById('solveBtn').addEventListener('click',()=>{
const names = [...tbody.querySelectorAll('tr td:first-child strong')].map(n=>n.textContent);
if(names.length===1){
alert(`✅ Correct! The culprit is ${names[0]} — nice filtering!`);
} else if (names.length===0){
alert('No suspects match yet. Try removing a clue.');
} else {
alert('More than one suspect left. Add another clue!');
}
});

// Teacher mode
document.getElementById('teacherToggle').addEventListener('click', (e)=>{
const btn = e.currentTarget;
const open = btn.getAttribute('aria-pressed') === 'true';
btn.setAttribute('aria-pressed', String(!open));
document.getElementById('teacher').style.display = open ? 'none' : 'block';
});

// Init
function init(){
renderClues();
renderTable(suspects);
queryBox.textContent = 'SELECT * FROM suspects;';
answerText.textContent = 'Bella (Classroom, Blue uniform, carrying hat, chalk dust).';
}
init();
</script>
</body>
</html>
